/*
 * W25Qxx_Flash.c
 *
 *  Created on: Feb 26, 2023
 *      Author: swift
 */


#include "W25Qxx_Flash.h"



void W25Qxx_GPIO_SPI_Initialization(void)
{
	LL_SPI_Enable(W25QXX_SPI_CHANNEL);
	CHIP_DESELECT(W25Qxx);
}


unsigned char SPI1_SendByte(unsigned char data)
{
	while(LL_SPI_IsActiveFlag_TXE(W25QXX_SPI_CHANNEL)==RESET);
	LL_SPI_TransmitData8(W25QXX_SPI_CHANNEL, data);

	while(LL_SPI_IsActiveFlag_RXNE(W25QXX_SPI_CHANNEL)==RESET);
	return LL_SPI_ReceiveData8(W25QXX_SPI_CHANNEL);
}

//////////////////////////////////////////////////////////////

uint8_t W25Qxx_Readbyte(uint8_t reg_addr)
{
	uint8_t val;

	CHIP_SELECT(W25Qxx);
	SPI1_SendByte(reg_addr | 0x80); //Register. MSB 1 is read instruction.
	val = SPI1_SendByte(0x00); //Send DUMMY to read data
	CHIP_DESELECT(W25Qxx);

	return val;
}

void W25Qxx_Readbytes(unsigned char reg_addr, unsigned char len, unsigned char* data)
{
	unsigned int i = 0;

	CHIP_SELECT(W25Qxx);
	SPI1_SendByte(reg_addr | 0x80); //Register. MSB 1 is read instruction.
	while(i < len)
	{
		data[i++] = SPI1_SendByte(0x00); //Send DUMMY to read data
	}
	CHIP_DESELECT(W25Qxx);
}

void W25Qxx_Writebyte(uint8_t reg_addr, uint8_t val)
{
	CHIP_SELECT(W25Qxx);
	SPI1_SendByte(reg_addr & 0x7F); //Register. MSB 0 is write instruction.
	SPI1_SendByte(val); //Send Data to write
	CHIP_DESELECT(W25Qxx);
}

void W25Qxx_Writebytes(unsigned char reg_addr, unsigned char len, unsigned char* data)
{
	unsigned int i = 0;
	CHIP_SELECT(W25Qxx);
	SPI1_SendByte(reg_addr & 0x7F); //Register. MSB 0 is write instruction.
	while(i < len)
	{
		SPI1_SendByte(data[i++]); //Send Data to write
	}
	CHIP_DESELECT(W25Qxx);
}

