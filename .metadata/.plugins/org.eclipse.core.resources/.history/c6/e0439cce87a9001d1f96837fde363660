
#include "GPS_Receiver.h"


void GPS_Parsing(GPS_RAW_MESSAGE* message, GPS_DATA* gps_data){
	uint8_t* ptr,*gps_ptr=message->gps_raw_buf;
	int32_t temp;
	if(gps_ptr[0]==0xB5 && gps_ptr[1]==0x62){
		ptr=gps_ptr+6+4;
		gps_data->lon = (ptr[3] << 24) + (ptr[2] << 16) + (ptr[1] << 8) + (ptr[0]);
		gps_data->longitude_deg=gps_data->lon/10000000;
		temp=gps_data->lon%10000000;
		gps_data->longitude_min=(temp*60)/10000000;
		temp=(temp*60)%10000000;
		gps_data->longitude_sec=((float)(temp*60))/10000000;

		if(gps_data->longitude_deg<124 || gps_data->longitude_deg>132){
			gps_data->sec_lon=0;
		}
		else{
			gps_data->sec_lon = (float)(gps_data->longitude_deg - LONGITUDE_OFFSET) * 3600 + (float)gps_data->longitude_min * 60 + gps_data->longitude_sec;
		}

		ptr += 4;
		gps_data->lat = (ptr[3] << 24) + (ptr[2] << 16) + (ptr[1] << 8) + (ptr[0]);
		gps_data->latitude_deg=gps_data->lat/10000000;
		temp=gps_data->lat%10000000;
		gps_data->latitude_min=(temp*60)/10000000;
		temp=(temp*60)%10000000;
		gps_data->latitude_sec=((float)(temp*60))/10000000;

		if(gps_data->latitude_deg<33 || gps_data->latitude_deg>43){
			gps_data->sec_lat=0;
		}
		else{
			gps_data->sec_lat = (float)(gps_data->latitude_deg - LATITUDE_OFFSET) * 3600 + (float)gps_data->latitude_min * 60 + gps_data->latitude_sec;
		}
		gps_ptr+=36;
	}
}



